<%= javascript_include_tag 'records' %>
<!-- Main -->
<section id="records">
<div class="container-fluid">
    <div class="row">
        <%= render :partial => "sidebar" %>
		<div class="recordsContent col-sm-9">
			<h3>投球查詢</h3>
			<hr>
			<% if @player == nil && @year == nil %>
				<script>
					function select_year(){
						year = document.getElementById('year').value;
						obj = eval('playerIn'+year);
						for(i=0;i<obj.length;i++) document.getElementById('player').options[i] = new Option(obj[i], obj[i]);
						document.getElementById('player').length = i;
						document.getElementById('player').selectedIndex = i - 1;
						i = document.getElementById('player').length;
						document.getElementById('player').options[i] = new Option("all", "all");
						document.getElementById('player').length = i + 1;
						document.getElementById('player').selectedIndex = i;
					
					}
					
					$(window).on('load', function(){
						select_year();
					});
					
					<% @year_option.each do |yearOption| %>
						var <%= 'playerIn' + yearOption[1].to_s %> = new Array();
						<% @playerInThisYear = playersInYear(yearOption[1],'Pitching') %>
						<% @playerInThisYear.each do |playerITY| %>
							<%= 'playerIn' + yearOption[1].to_s %>.push("<%= playerITY.player_id %>");
						<% end %>
					<% end %>
				</script>
				<%= form_tag("pitching" , method:"get") do %>
					<table>
						<tr>
							<td><%= select_tag(:year, options_for_select(@year_option,@year_option[@year_option.length-2][1]), onchange:"select_year();") %></td>
							<td><%= select_tag(:player) %></td>
						</tr>
						<tr>
							<td colspan="2"><%= submit_tag("查詢", name: nil) %></td>
						</tr>
					</table>
				<% end %>
			
			<% elsif @player == 'all' %>
				<% if @year == 'Wildcard' %>
					<h4>不分年度 投球成績 - 依年度分組</h4>
					<br/>
					<h5 style="margin:0 0 10px; text-transform:none">Active Player: 認定標準為每場<%= @activePLAYER_rate %>局；或局數達<%= '%.1f' % @activePLAYER %>以上者。</h5>
					<h5>各年度標準如下:</h5>
					<h5>
						<% @gameNumberInEachYear.each_with_index do |gNIEY,index| %>
							<%= gNIEY.year %>年度共<%= @gameNumberInYear[gNIEY.year.to_s] %>場比賽。<%= (index % 2 == 1)?('<br/>'.html_safe):('') %>
						<% end %>
					</h5>
					<h5 style="margin:0 0 10px; text-transform:none" id="descriptionPitInYear"></h5>
					<h5 style="margin:0 0 10px; text-transform:none"><點選各項目表頭以進行排序></h5>
					<div class="wrapperForScrollbar" id="wrapper_pitching_allInYear">
						<div class="fakeContentForScrollBar" id="content_pitching_allInYear"></div>
					</div>
					<div class="table-responsive" id="div_pitching_allInYear">
						<table class="table table-striped table-condensed" id="table_pitching_allInYear" data-toggle="table" data-sort-name="W" data-sort-order="desc">
							<thead>
								<tr>
									<th class= "colName" data-field="Name" data-sortable="true" data-sorter="NameYearSorter" data-align="center">Pitcher<br/>投手</th>
									<th class= "colYear" data-field="Year" data-sortable="true" data-sorter="normalYearSorter" data-align="center">Year<br/>年度</th>
									<th class= "colG" data-field="G" data-sortable="true" data-sorter="normalYearSorter" data-align="center">G<br/>出賽</th>
									<th class= "colW" data-field="W" data-sortable="true" data-sorter="normalYearSorter" data-align="center">W<br/>勝投</th>
									<th class= "colL" data-field="L" data-sortable="true" data-sorter="normalYearSorter" data-align="center">L<br/>敗投</th>
									<th class= "colIP" data-field="IP" data-sortable="true" data-sorter="normalYearSorter" data-align="center">IP<br/>局數</th>
									<th class= "colTBF" data-field="TBF" data-sortable="true" data-sorter="normalYearSorter" data-align="center">TBF<br/>面對打席</th>
									<th class= "colH" data-field="H" data-sortable="true" data-sorter="normalYearSorter" data-align="center">H<br/>被安打</th>
									<th class= "colHR" data-field="HR" data-sortable="true" data-sorter="normalYearSorter" data-align="center">HR<br/>被全壘打</th>
									<th class= "colSO" data-field="SO" data-sortable="true" data-sorter="normalYearSorter" data-align="center">SO<br/>三振</th>
									<th class= "colBB" data-field="BB" data-sortable="true" data-sorter="normalYearSorter" data-align="center">BB<br/>四壞</th>
									<th class= "colIBB" data-field="IBB" data-sortable="true" data-sorter="normalYearSorter" data-align="center">IBB<br/>故意</th>
									<th class= "colR" data-field="R" data-sortable="true" data-sorter="normalYearSorter" data-align="center">R<br/>失分</th>
									<th class= "colER" data-field="ER" data-sortable="true" data-sorter="normalYearSorter" data-align="center">ER<br/>自責</th>
									<th class= "colAVG" data-field="AVG" data-sortable="true" data-sort-name="_AVG_data" data-sorter="AVGYearSorter" data-align="center">AVG<br/>被打擊率</th>
									<th class= "colWHIP" data-field="WHIP" data-sortable="true" data-sort-name="_WHIP_data" data-sorter="WHIPYearSorter" data-align="center">WHIP<br/>每局被上壘率</th>
									<th class= "colERA5" data-field="ERA5" data-sortable="true" data-sort-name="_ERA5_data" data-sorter="ERA5YearSorter" data-align="center">ERA5<br/>五局防禦率</th>
									<th class= "colERA7" data-field="ERA7" data-sortable="true" data-sort-name="_ERA7_data" data-sorter="ERA7YearSorter" data-align="center">ERA7<br/>七局防禦率</th>
									<th class= "colR5" data-field="R5" data-sortable="true" data-sort-name="_R5_data" data-sorter="R5YearSorter" data-align="center">R/5<br/>五局失分率</th>
									<th class= "colR7" data-field="R7" data-sortable="true" data-sort-name="_R7_data" data-sorter="R7YearSorter" data-align="center">R/7<br/>七局失分率</th>
								</tr>
							</thead>
							<script>
								$(function(){
									var SortedName = '';
									$('#table_pitching_allInYear').on('sort.bs.table', function (e, name, order) {
										SortedName = name;
									});
									$('#table_pitching_allInYear').on('post-body.bs.table', function () {
										$('#table_pitching_allInYear').find('tbody tr td').each(function(){
											if($(this).hasClass('sorting')){
												$(this).removeClass('sorting');
											}
										});
										SortedItem = $('#table_pitching_allInYear').find('tbody tr td.col'+SortedName);
										SortedItem.each(function(){
											$(this).addClass('sorting');
										});
									});
								});
								$(window).on('load resize', function(){
									$('#wrapper_pitching_allInYear').width($('#div_pitching_allInYear').width());
									$('#content_pitching_allInYear').width($('#table_pitching_allInYear').width());
								});
								$(function(){
									wrapperForTableInYear = $("#table_pitching_allInYear").parent('div')
									$("#wrapper_pitching_allInYear").scroll(function(){
										wrapperForTableInYear.scrollLeft($("#wrapper_pitching_allInYear").scrollLeft());
									});
									wrapperForTableInYear.scroll(function(){
										$("#wrapper_pitching_allInYear").scrollLeft(wrapperForTableInYear.scrollLeft());
									});
								});
								function clearDescriptionInYear(){
									$('#descriptionPitInYear').text('');
								}
								function NameYearSorter(a, b) {
									clearDescriptionInYear();
									if (a.toLowerCase() > b.toLowerCase()) return 1;
									if (a.toLowerCase() < b.toLowerCase()) return -1;
									return 0;
								}
								function normalYearSorter(a, b) {
									clearDescriptionInYear();
									if (parseFloat(a) > parseFloat(b)) return 1;
									if (parseFloat(a) < parseFloat(b)) return -1;
									return 0;
								}
								function AVGYearSorter(a, b) {
									$('#descriptionPitInYear').text('被打擊率 = 被安打數 / 面對打數');
									// 兩階段sorting - 先過濾局數是否足額
									thresholdA = Math.min(a.threshold, <%= @activePLAYER %>);
									thresholdB = Math.min(b.threshold, <%= @activePLAYER %>);
									if(a.ip >= thresholdA && b.ip < thresholdB)
										return 1;
									else if(a.ip < thresholdA && b.ip >= thresholdB)
										return -1;
									// 再相比實際數值
									else{
										if (a.avg != "-.---" && b.avg == "-.---") return 1;
										if (a.avg == "-.---" && b.avg != "-.---") return -1;
										if (a.avg == "-.---" && b.avg == "-.---") return 0;
										if (a.avg == "∞" && b.avg != "∞") return -1;
										if (a.avg != "∞" && b.avg == "∞") return 1;
										if (a.avg == "∞" && b.avg == "∞") return 0;
										if (a.avg < b.avg) return 1;
										if (a.avg > b.avg) return -1;
										return 0;
									}
								}
								function WHIPYearSorter(a, b) {
									$('#descriptionPitInYear').text('每局被上壘率 = (被安打數 + 四壞) / 投球局數');
									// 兩階段sorting - 先過濾局數是否足額
									thresholdA = Math.min(a.threshold, <%= @activePLAYER %>);
									thresholdB = Math.min(b.threshold, <%= @activePLAYER %>);
									if(a.ip >= thresholdA && b.ip < thresholdB)
										return 1;
									else if(a.ip < thresholdA && b.ip >= thresholdB)
										return -1;
									// 再相比實際數值
									else{
										if (a.whip != "-.--" && b.whip == "-.--") return 1;
										if (a.whip == "-.--" && b.whip != "-.--") return -1;
										if (a.whip == "-.--" && b.whip == "-.--") return 0;
										if (a.whip == "∞" && b.whip != "∞") return -1;
										if (a.whip != "∞" && b.whip == "∞") return 1;
										if (a.whip == "∞" && b.whip == "∞") return 0;
										if (a.whip < b.whip) return 1;
										if (a.whip > b.whip) return -1;
										return 0;
									}
								}
								function ERA5YearSorter(a, b) {
									$('#descriptionPitInYear').text('五局防禦率 = 自責分 x 5 / 投球局數');
									// 兩階段sorting - 先過濾局數是否足額
									thresholdA = Math.min(a.threshold, <%= @activePLAYER %>);
									thresholdB = Math.min(b.threshold, <%= @activePLAYER %>);
									if(a.ip >= thresholdA && b.ip < thresholdB)
										return 1;
									else if(a.ip < thresholdA && b.ip >= thresholdB)
										return -1;
									// 再相比實際數值
									else{
										if (a.era5 != "-.--" && b.era5 == "-.--") return 1;
										if (a.era5 == "-.--" && b.era5 != "-.--") return -1;
										if (a.era5 == "-.--" && b.era5 == "-.--") return 0;
										if (a.era5 == "∞" && b.era5 != "∞") return -1;
										if (a.era5 != "∞" && b.era5 == "∞") return 1;
										if (a.era5 == "∞" && b.era5 == "∞") return 0;
										if (a.era5 < b.era5) return 1;
										if (a.era5 > b.era5) return -1;
										return 0;
									}
								}
								function ERA7YearSorter(a, b) {
									$('#descriptionPitInYear').text('七局防禦率 = 自責分 x 7 / 投球局數');
									// 兩階段sorting - 先過濾局數是否足額
									thresholdA = Math.min(a.threshold, <%= @activePLAYER %>);
									thresholdB = Math.min(b.threshold, <%= @activePLAYER %>);
									if(a.ip >= thresholdA && b.ip < thresholdB)
										return 1;
									else if(a.ip < thresholdA && b.ip >= thresholdB)
										return -1;
									// 再相比實際數值
									else{
										if (a.era7 != "-.--" && b.era7 == "-.--") return 1;
										if (a.era7 == "-.--" && b.era7 != "-.--") return -1;
										if (a.era7 == "-.--" && b.era7 == "-.--") return 0;
										if (a.era7 == "∞" && b.era7 != "∞") return -1;
										if (a.era7 != "∞" && b.era7 == "∞") return 1;
										if (a.era7 == "∞" && b.era7 == "∞") return 0;
										if (a.era7 < b.era7) return 1;
										if (a.era7 > b.era7) return -1;
										return 0;
									}
								}
								function R5YearSorter(a, b) {
									$('#descriptionPitInYear').text('五局失分率 = 失分 x 5 / 投球局數');
									// 兩階段sorting - 先過濾局數是否足額
									thresholdA = Math.min(a.threshold, <%= @activePLAYER %>);
									thresholdB = Math.min(b.threshold, <%= @activePLAYER %>);
									if(a.ip >= thresholdA && b.ip < thresholdB)
										return 1;
									else if(a.ip < thresholdA && b.ip >= thresholdB)
										return -1;
									// 再相比實際數值
									else{
										if (a.r5 != "-.--" && b.r5 == "-.--") return 1;
										if (a.r5 == "-.--" && b.r5 != "-.--") return -1;
										if (a.r5 == "-.--" && b.r5 == "-.--") return 0;
										if (a.r5 == "∞" && b.r5 != "∞") return -1;
										if (a.r5 != "∞" && b.r5 == "∞") return 1;
										if (a.r5 == "∞" && b.r5 == "∞") return 0;
										if (a.r5 < b.r5) return 1;
										if (a.r5 > b.r5) return -1;
										return 0;
									}
								}
								function R7YearSorter(a, b) {
									$('#descriptionPitInYear').text('七局失分率 = 失分 x 7 / 投球局數');
									// 兩階段sorting - 先過濾局數是否足額
									thresholdA = Math.min(a.threshold, <%= @activePLAYER %>);
									thresholdB = Math.min(b.threshold, <%= @activePLAYER %>);
									if(a.ip >= thresholdA && b.ip < thresholdB)
										return 1;
									else if(a.ip < thresholdA && b.ip >= thresholdB)
										return -1;
									// 再相比實際數值
									else{
										if (a.r7 != "-.--" && b.r7 == "-.--") return 1;
										if (a.r7 == "-.--" && b.r7 != "-.--") return -1;
										if (a.r7 == "-.--" && b.r7 == "-.--") return 0;
										if (a.r7 == "∞" && b.r7 != "∞") return -1;
										if (a.r7 != "∞" && b.r7 == "∞") return 1;
										if (a.r7 == "∞" && b.r7 == "∞") return 0;
										if (a.r7 < b.r7) return 1;
										if (a.r7 > b.r7) return -1;
										return 0;
									}
								}
							</script>
							<% if @allPitchingEachYear.size != 0 %>
								<tbody>
									<% @allPitchingEachYear.each do |allPitYear| %>
										<% if allPitYear.IP >= @gameNumberInYear[allPitYear.year.to_s] * @activePLAYER_rate || allPitYear.IP >= @activePLAYER %>
											<tr>
										<% else %>
											<tr class="nonActive">
										<% end %>
												<td class="colName">
													<%= link_to allPitYear.player_id, controller: "records", action: "pitching", player: allPitYear.player_id, year: @year %>
												</td>
												<td class="colYear">
													<%= link_to allPitYear.year, controller: "records", action: "pitching", player: allPitYear.player_id, year: allPitYear.year %>
												</td>
												<td class="colG"><%= allPitYear.Game %></td>
												<td class="colW sorting"><%= allPitYear.W %></td>
												<td class="colL"><%= allPitYear.L %></td>
												<td class="colIP"><%= '%.1f' % allPitYear.IP.round(1) %></td>
												<td class="colTBF"><%= allPitYear.TBF %></td>
												<td class="colH"><%= allPitYear.H %></td>
												<td class="colHR"><%= allPitYear.HR %></td>
												<td class="colSO"><%= allPitYear.SO %></td>
												<td class="colBB"><%= allPitYear.BB %></td>
												<td class="colIBB"><%= allPitYear.IBB %></td>
												<td class="colR"><%= allPitYear.R %></td>
												<td class="colER"><%= allPitYear.ER %></td>
												<td class="colAVG" data-threshold="<%= @gameNumberInYear[allPitYear.year.to_s] * @activePLAYER_rate %>" data-IP="<%= allPitYear.IP %>" data-AVG="<%= sortHelper((allPitYear.TBF - allPitYear.BB - allPitYear.IBB),allPitYear.H,allPitYear.AVG,3) %>">
													<% if allPitYear.TBF - allPitYear.BB - allPitYear.IBB == 0 %>
														<% if allPitYear.H == 0 %>
															-.---
														<% else %>
															∞
														<% end %>
													<% else %>
														<%= '%.3f' % allPitYear.AVG.round(3) %>
													<% end %>
												</td>
												<td class="colWHIP" data-threshold="<%= @gameNumberInYear[allPitYear.year.to_s] * @activePLAYER_rate %>" data-IP="<%= allPitYear.IP %>" data-WHIP="<%= sortHelper(allPitYear.IP,(allPitYear.H + allPitYear.BB + allPitYear.IBB),allPitYear.WHIP,2) %>">
													<% if allPitYear.IP == 0.0 %>
														<% if allPitYear.H + allPitYear.BB + allPitYear.IBB == 0 %>
															-.--
														<% else %>
															∞
														<% end %>
													<% else %>
														<%= '%.2f' % allPitYear.WHIP.round(2) %>
													<% end %>
												</td>
												<td class="colERA5" data-threshold="<%= @gameNumberInYear[allPitYear.year.to_s] * @activePLAYER_rate %>" data-IP="<%= allPitYear.IP %>" data-ERA5="<%= sortHelper(allPitYear.IP,allPitYear.ER,allPitYear.ERA5,2) %>">
													<% if allPitYear.IP == 0.0 %>
														<% if allPitYear.ER == 0 %>
															-.--
														<% else %>
															∞
														<% end %>
													<% else %>
														<%= '%.2f' % allPitYear.ERA5.round(2) %>
													<% end %>
												</td>
												<td class="colERA7" data-threshold="<%= @gameNumberInYear[allPitYear.year.to_s] * @activePLAYER_rate %>" data-IP="<%= allPitYear.IP %>" data-ERA7="<%= sortHelper(allPitYear.IP,allPitYear.ER,allPitYear.ERA7,2) %>">
													<% if allPitYear.IP == 0.0 %>
														<% if allPitYear.ER == 0 %>
															-.--
														<% else %>
															∞
														<% end %>
													<% else %>
														<%= '%.2f' % allPitYear.ERA7.round(2) %>
													<% end %>
												</td>
												<td class="colR5" data-threshold="<%= @gameNumberInYear[allPitYear.year.to_s] * @activePLAYER_rate %>" data-IP="<%= allPitYear.IP %>" data-R5="<%= sortHelper(allPitYear.IP,allPitYear.R,allPitYear.R5,2) %>">
													<% if allPitYear.IP == 0.0 %>
														<% if allPitYear.R == 0 %>
															-.--
														<% else %>
															∞
														<% end %>
													<% else %>
														<%= '%.2f' % allPitYear.R5.round(2) %>
													<% end %>
												</td>
												<td class="colR7" data-threshold="<%= @gameNumberInYear[allPitYear.year.to_s] * @activePLAYER_rate %>" data-IP="<%= allPitYear.IP %>" data-R7="<%= sortHelper(allPitYear.IP,allPitYear.R,allPitYear.R7,2) %>">
													<% if allPitYear.IP == 0.0 %>
														<% if allPitYear.R == 0 %>
															-.--
														<% else %>
															∞
														<% end %>
													<% else %>
														<%= '%.2f' % allPitYear.R7.round(2) %>
													<% end %>
												</td>
											</tr>
									<% end %>
								</tbody>	
							<% end %>
						</table>
					</div>
					<br/>
				<% end %>
				<h4><%= @year == 'Wildcard'? ("不分年度"):(@year.to_s + '年(' + (@year.to_i-1911).to_s + '年度)') %> 投球成績</h4>
				<br/>
				<h5 style="margin:0 0 10px; text-transform:none">Active Player: 認定標準為每場<%= @activePLAYER_rate %>局 -- 目前 <%= @gameNumberInYear[@year.to_s] %> 場；或局數達<%= '%.1f' % @activePLAYER %>以上者。</h5>
				<h5 style="margin:0 0 10px; text-transform:none" id="descriptionPit"></h5>
				<h5 style="margin:0 0 10px; text-transform:none"><點選各項目表頭以進行排序></h5>
				<div class="wrapperForScrollbar" id="wrapper_pitching_all">
					<div class="fakeContentForScrollBar" id="content_pitching_all"></div>
				</div>
				<div class="table-responsive" id="div_pitching_all">
					<table class="table table-striped table-condensed" id="table_pitching_all" data-toggle="table" data-sort-name="<%= @sortBy %>" data-sort-order="desc">
						<thead>
							<tr>
								<th class= "colName" data-field="Name" data-sortable="true" data-sorter="NameSorter" data-align="center">Pitcher<br/>投手</th>
								<th class= "colG" data-field="G" data-sortable="true" data-sorter="normalSorter" data-align="center">G<br/>出賽</th>
								<th class= "colW" data-field="W" data-sortable="true" data-sorter="normalSorter" data-align="center">W<br/>勝投</th>
								<th class= "colL" data-field="L" data-sortable="true" data-sorter="normalSorter" data-align="center">L<br/>敗投</th>
								<th class= "colIP" data-field="IP" data-sortable="true" data-sorter="normalSorter" data-align="center">IP<br/>局數</th>
								<th class= "colTBF" data-field="TBF" data-sortable="true" data-sorter="normalSorter" data-align="center">TBF<br/>面對打席</th>
								<th class= "colH" data-field="H" data-sortable="true" data-sorter="normalSorter" data-align="center">H<br/>被安打</th>
								<th class= "colHR" data-field="HR" data-sortable="true" data-sorter="normalSorter" data-align="center">HR<br/>被全壘打</th>
								<th class= "colSO" data-field="SO" data-sortable="true" data-sorter="normalSorter" data-align="center">SO<br/>三振</th>
								<th class= "colBB" data-field="BB" data-sortable="true" data-sorter="normalSorter" data-align="center">BB<br/>四壞</th>
								<th class= "colIBB" data-field="IBB" data-sortable="true" data-sorter="normalSorter" data-align="center">IBB<br/>故意</th>
								<th class= "colR" data-field="R" data-sortable="true" data-sorter="normalSorter" data-align="center">R<br/>失分</th>
								<th class= "colER" data-field="ER" data-sortable="true" data-sorter="normalSorter" data-align="center">ER<br/>自責</th>
								<th class= "colAVG" data-field="AVG" data-sortable="true" data-sort-name="_AVG_data" data-sorter="AVGSorter" data-align="center">AVG<br/>被打擊率</th>
								<th class= "colWHIP" data-field="WHIP" data-sortable="true" data-sort-name="_WHIP_data" data-sorter="WHIPSorter" data-align="center">WHIP<br/>每局被上壘率</th>
								<th class= "colERA5" data-field="ERA5" data-sortable="true" data-sort-name="_ERA5_data" data-sorter="ERA5Sorter" data-align="center">ERA5<br/>五局防禦率</th>
								<th class= "colERA7" data-field="ERA7" data-sortable="true" data-sort-name="_ERA7_data" data-sorter="ERA7Sorter" data-align="center">ERA7<br/>七局防禦率</th>
								<th class= "colR5" data-field="R5" data-sortable="true" data-sort-name="_R5_data" data-sorter="R5Sorter" data-align="center">R/5<br/>五局失分率</th>
								<th class= "colR7" data-field="R7" data-sortable="true" data-sort-name="_R7_data" data-sorter="R7Sorter" data-align="center">R/7<br/>七局失分率</th>
							</tr>
						</thead>
						<script>
							$(function(){
								<% if @sortBy != nil %>
									if(!$('#table_pitching_all * td.col<%= @sortBy %>').hasClass('sorting'))
										$('#table_pitching_all * td.col<%= @sortBy %>').addClass('sorting')
								<% end %>
								
								var SortedName = '';
								$('#table_pitching_all').on('sort.bs.table', function (e, name, order) {
									SortedName = name;
								});
								$('#table_pitching_all').on('post-body.bs.table', function () {
									$('#table_pitching_all').find('tbody tr td').each(function(){
										if($(this).hasClass('sorting')){
											$(this).removeClass('sorting');
										}
									});
									SortedItem = $('#table_pitching_all').find('tbody tr td.col'+SortedName);
									SortedItem.each(function(){
										$(this).addClass('sorting');
									});
								});
							});
							$(window).on('load resize', function(){
								$('#wrapper_pitching_all').width($('#div_pitching_all').width());
								$('#content_pitching_all').width($('#table_pitching_all').width());
							});
							$(function(){
								wrapperForTable = $("#table_pitching_all").parent('div')
								$("#wrapper_pitching_all").scroll(function(){
									wrapperForTable.scrollLeft($("#wrapper_pitching_all").scrollLeft());
								});
								wrapperForTable.scroll(function(){
									$("#wrapper_pitching_all").scrollLeft(wrapperForTable.scrollLeft());
								});
							});
							function clearDescription(){
								$('#descriptionPit').text('');
							}
							function NameSorter(a, b) {
								clearDescription();
								if (a.toLowerCase() > b.toLowerCase()) return 1;
								if (a.toLowerCase() < b.toLowerCase()) return -1;
								return 0;
							}
							function normalSorter(a, b) {
								clearDescription();
								if (parseFloat(a) > parseFloat(b)) return 1;
								if (parseFloat(a) < parseFloat(b)) return -1;
								return 0;
							}
							function AVGSorter(a, b) {
								$('#descriptionPit').text('被打擊率 = 被安打數 / 面對打數');
								// 兩階段sorting - 先過濾局數是否足額
								threshold = Math.min((<%= @gameNumberInYear[@year.to_s] * @activePLAYER_rate %>), <%= @activePLAYER %>);
								if(a.ip >= threshold && b.ip < threshold)
									return 1;
								else if(a.ip < threshold && b.ip >= threshold)
									return -1;
								// 再相比實際數值
								else{
									if (a.avg != "-.---" && b.avg == "-.---") return 1;
									if (a.avg == "-.---" && b.avg != "-.---") return -1;
									if (a.avg == "-.---" && b.avg == "-.---") return 0;
									if (a.avg == "∞" && b.avg != "∞") return -1;
									if (a.avg != "∞" && b.avg == "∞") return 1;
									if (a.avg == "∞" && b.avg == "∞") return 0;
									if (a.avg < b.avg) return 1;
									if (a.avg > b.avg) return -1;
									return 0;
								}
							}
							function WHIPSorter(a, b) {
								$('#descriptionPit').text('每局被上壘率 = (被安打數 + 四壞) / 投球局數');
								// 兩階段sorting - 先過濾局數是否足額
								threshold = Math.min((<%= @gameNumberInYear[@year.to_s] * @activePLAYER_rate %>), <%= @activePLAYER %>);
								if(a.ip >= threshold && b.ip < threshold)
									return 1;
								else if(a.ip < threshold && b.ip >= threshold)
									return -1;
								// 再相比實際數值
								else{
									if (a.whip != "-.--" && b.whip == "-.--") return 1;
									if (a.whip == "-.--" && b.whip != "-.--") return -1;
									if (a.whip == "-.--" && b.whip == "-.--") return 0;
									if (a.whip == "∞" && b.whip != "∞") return -1;
									if (a.whip != "∞" && b.whip == "∞") return 1;
									if (a.whip == "∞" && b.whip == "∞") return 0;
									if (a.whip < b.whip) return 1;
									if (a.whip > b.whip) return -1;
									return 0;
								}
							}
							function ERA5Sorter(a, b) {
								$('#descriptionPit').text('五局防禦率 = 自責分 x 5 / 投球局數');
								// 兩階段sorting - 先過濾局數是否足額
								threshold = Math.min((<%= @gameNumberInYear[@year.to_s] * @activePLAYER_rate %>), <%= @activePLAYER %>);
								if(a.ip >= threshold && b.ip < threshold)
									return 1;
								else if(a.ip < threshold && b.ip >= threshold)
									return -1;
								// 再相比實際數值
								else{
									if (a.era5 != "-.--" && b.era5 == "-.--") return 1;
									if (a.era5 == "-.--" && b.era5 != "-.--") return -1;
									if (a.era5 == "-.--" && b.era5 == "-.--") return 0;
									if (a.era5 == "∞" && b.era5 != "∞") return -1;
									if (a.era5 != "∞" && b.era5 == "∞") return 1;
									if (a.era5 == "∞" && b.era5 == "∞") return 0;
									if (a.era5 < b.era5) return 1;
									if (a.era5 > b.era5) return -1;
									return 0;
								}
							}
							function ERA7Sorter(a, b) {
								$('#descriptionPit').text('七局防禦率 = 自責分 x 7 / 投球局數');
								// 兩階段sorting - 先過濾局數是否足額
								threshold = Math.min((<%= @gameNumberInYear[@year.to_s] * @activePLAYER_rate %>), <%= @activePLAYER %>);
								if(a.ip >= threshold && b.ip < threshold)
									return 1;
								else if(a.ip < threshold && b.ip >= threshold)
									return -1;
								// 再相比實際數值
								else{
									if (a.era7 != "-.--" && b.era7 == "-.--") return 1;
									if (a.era7 == "-.--" && b.era7 != "-.--") return -1;
									if (a.era7 == "-.--" && b.era7 == "-.--") return 0;
									if (a.era7 == "∞" && b.era7 != "∞") return -1;
									if (a.era7 != "∞" && b.era7 == "∞") return 1;
									if (a.era7 == "∞" && b.era7 == "∞") return 0;
									if (a.era7 < b.era7) return 1;
									if (a.era7 > b.era7) return -1;
									return 0;
								}
							}
							function R5Sorter(a, b) {
								$('#descriptionPit').text('五局失分率 = 失分 x 5 / 投球局數');
								// 兩階段sorting - 先過濾局數是否足額
								threshold = Math.min((<%= @gameNumberInYear[@year.to_s] * @activePLAYER_rate %>), <%= @activePLAYER %>);
								if(a.ip >= threshold && b.ip < threshold)
									return 1;
								else if(a.ip < threshold && b.ip >= threshold)
									return -1;
								// 再相比實際數值
								else{
									if (a.r5 != "-.--" && b.r5 == "-.--") return 1;
									if (a.r5 == "-.--" && b.r5 != "-.--") return -1;
									if (a.r5 == "-.--" && b.r5 == "-.--") return 0;
									if (a.r5 == "∞" && b.r5 != "∞") return -1;
									if (a.r5 != "∞" && b.r5 == "∞") return 1;
									if (a.r5 == "∞" && b.r5 == "∞") return 0;
									if (a.r5 < b.r5) return 1;
									if (a.r5 > b.r5) return -1;
									return 0;
								}
							}
							function R7Sorter(a, b) {
								$('#descriptionPit').text('七局失分率 = 失分 x 7 / 投球局數');
								// 兩階段sorting - 先過濾局數是否足額
								threshold = Math.min((<%= @gameNumberInYear[@year.to_s] * @activePLAYER_rate %>), <%= @activePLAYER %>);
								if(a.ip >= threshold && b.ip < threshold)
									return 1;
								else if(a.ip < threshold && b.ip >= threshold)
									return -1;
								// 再相比實際數值
								else{
									if (a.r7 != "-.--" && b.r7 == "-.--") return 1;
									if (a.r7 == "-.--" && b.r7 != "-.--") return -1;
									if (a.r7 == "-.--" && b.r7 == "-.--") return 0;
									if (a.r7 == "∞" && b.r7 != "∞") return -1;
									if (a.r7 != "∞" && b.r7 == "∞") return 1;
									if (a.r7 == "∞" && b.r7 == "∞") return 0;
									if (a.r7 < b.r7) return 1;
									if (a.r7 > b.r7) return -1;
									return 0;
								}
							}
						</script>
						<% if @allPitching.size != 0 %>
							<tbody>
								<% @allPitching.each do |allPit| %>
									<% if allPit.IP >= @gameNumberInYear[@year.to_s] * @activePLAYER_rate || allPit.IP >= @activePLAYER %>
										<tr>
									<% else %>
										<tr class="nonActive">
									<% end %>
											<td class="colName">
												<%= link_to allPit.player_id, controller: "records", action: "pitching", player: allPit.player_id, year: @year %>
											</td>
											<td class="colG"><%= allPit.G %></td>
											<td class="colW"><%= allPit.W %></td>
											<td class="colL"><%= allPit.L %></td>
											<td class="colIP"><%= '%.1f' % allPit.IP.round(1) %></td>
											<td class="colTBF"><%= allPit.TBF %></td>
											<td class="colH"><%= allPit.H %></td>
											<td class="colHR"><%= allPit.HR %></td>
											<td class="colSO"><%= allPit.SO %></td>
											<td class="colBB"><%= allPit.BB %></td>
											<td class="colIBB"><%= allPit.IBB %></td>
											<td class="colR"><%= allPit.R %></td>
											<td class="colER"><%= allPit.ER %></td>
											<td class="colAVG" data-IP="<%= allPit.IP %>" data-AVG="<%= sortHelper((allPit.TBF - allPit.BB - allPit.IBB),allPit.H,allPit.AVG,3) %>">
												<% if allPit.TBF - allPit.BB - allPit.IBB == 0 %>
													<% if allPit.H == 0 %>
														-.---
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.3f' % allPit.AVG.round(3) %>
												<% end %>
											</td>
											<td class="colWHIP" data-IP="<%= allPit.IP %>" data-WHIP="<%= sortHelper(allPit.IP,(allPit.H + allPit.BB + allPit.IBB),allPit.WHIP,2) %>">
												<% if allPit.IP == 0.0 %>
													<% if allPit.H + allPit.BB + allPit.IBB == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % allPit.WHIP.round(2) %>
												<% end %>
											</td>
											<td class="colERA5" data-IP="<%= allPit.IP %>" data-ERA5="<%= sortHelper(allPit.IP,allPit.ER,allPit.ERA5,2) %>">
												<% if allPit.IP == 0.0 %>
													<% if allPit.ER == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % allPit.ERA5.round(2) %>
												<% end %>
											</td>
											<td class="colERA7" data-IP="<%= allPit.IP %>" data-ERA7="<%= sortHelper(allPit.IP,allPit.ER,allPit.ERA7,2) %>">
												<% if allPit.IP == 0.0 %>
													<% if allPit.ER == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % allPit.ERA7.round(2) %>
												<% end %>
											</td>
											<td class="colR5" data-IP="<%= allPit.IP %>" data-R5="<%= sortHelper(allPit.IP,allPit.R,allPit.R5,2) %>">
												<% if allPit.IP == 0.0 %>
													<% if allPit.R == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % allPit.R5.round(2) %>
												<% end %>
											</td>
											<td class="colR7" data-IP="<%= allPit.IP %>" data-R7="<%= sortHelper(allPit.IP,allPit.R,allPit.R7,2) %>">
												<% if allPit.IP == 0.0 %>
													<% if allPit.R == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % allPit.R7.round(2) %>
												<% end %>
											</td>
										</tr>
								<% end %>
							</tbody>	
						<% end %>
					</table>
				</div>
				<br/>
				<h4><%= @year == "Wildcard"? ("不分年度"):(@year.to_s + '年(' + (@year.to_i-1911).to_s + '年度)') %> 投球成績總結</h4>
				<br/>
				<div class="table-responsive" id="div_pitching_all_summary">
					<table class="table table-striped table-condensed" id="table_pitching_all_summary">
						<thead>
							<tr>
								<th>W<br/>勝投</th>
								<th>L<br/>敗投</th>
								<th>IP<br/>局數</th>
								<th>TBF<br/>面對打席</th>
								<th>H<br/>被安打</th>
								<th>HR<br/>被全壘打</th>
								<th>SO<br/>三振</th>
								<th>BB<br/>四壞</th>
								<th>IBB<br/>故意</th>
								<th>R<br/>失分</th>
								<th>ER<br/>自責</th>
								<th>AVG<br/>被打擊率</th>
								<th>WHIP<br/>每局被上壘率</th>
								<th>ERA5<br/>五局防禦率</th>
								<th>ERA7<br/>七局防禦率</th>
								<th>R/5<br/>五局失分率</th>
								<th>R/7<br/>七局失分率</th>
							</tr>
						</thead>
						<% if @allPitchingSummary.TBF != nil %>
							<tbody>
								<td><%= @allPitchingSummary.W %></td>
								<td><%= @allPitchingSummary.L %></td>
								<td><%= '%.1f' % @allPitchingSummary.IP.round(1) %></td>
								<td><%= @allPitchingSummary.TBF %></td>
								<td><%= @allPitchingSummary.H %></td>
								<td><%= @allPitchingSummary.HR %></td>
								<td><%= @allPitchingSummary.SO %></td>
								<td><%= @allPitchingSummary.BB %></td>
								<td><%= @allPitchingSummary.IBB %></td>
								<td><%= @allPitchingSummary.R %></td>
								<td><%= @allPitchingSummary.ER %></td>
								<td>
									<% if @allPitchingSummary.TBF - @allPitchingSummary.BB - @allPitchingSummary.IBB == 0 %>
										<% if @allPitchingSummary.H == 0 %>
											-.---
										<% else %>
											∞
										<% end %>
									<% else %>
										<%= '%.3f' % @allPitchingSummary.AVG.round(3) %>
									<% end %>
								</td>
								<td>
									<% if @allPitchingSummary.IP == 0.0 %>
										<% if @allPitchingSummary.H + @allPitchingSummary.BB + @allPitchingSummary.IBB == 0 %>
											-.--
										<% else %>
											∞
										<% end %>
									<% else %>
										<%= '%.2f' % @allPitchingSummary.WHIP.round(2) %>
									<% end %>
								</td>
								<td>
									<% if @allPitchingSummary.IP == 0.0 %>
										<% if @allPitchingSummary.ER == 0 %>
											-.--
										<% else %>
											∞
										<% end %>
									<% else %>
										<%= '%.2f' % @allPitchingSummary.ERA5.round(2) %>
									<% end %>
								</td>
								<td>
									<% if @allPitchingSummary.IP == 0.0 %>
										<% if @allPitchingSummary.ER == 0 %>
											-.--
										<% else %>
											∞
										<% end %>
									<% else %>
										<%= '%.2f' % @allPitchingSummary.ERA7.round(2) %>
									<% end %>
								</td>
								<td>
									<% if @allPitchingSummary.IP == 0.0 %>
										<% if @allPitchingSummary.R == 0 %>
											-.--
										<% else %>
											∞
										<% end %>
									<% else %>
										<%= '%.2f' % @allPitchingSummary.R5.round(2) %>
									<% end %>
								</td>
								<td>
									<% if @allPitchingSummary.IP == 0.0 %>
										<% if @allPitchingSummary.R == 0 %>
											-.--
										<% else %>
											∞
										<% end %>
									<% else %>
										<%= '%.2f' % @allPitchingSummary.R7.round(2) %>
									<% end %>
								</td>
							</tbody>
						<% end %>
					</table>
				</div>
				<br/>
				<h4>平均五/七局表現</h4>
				<br/>
				<div class="table-responsive" id="div_pitching_all_IP">
					<table class="table table-striped table-condensed" id="table_pitching_all_IP">
						<thead>
							<tr>
								<th>Pitcher<br/>投手</th>
								<th>TBF<br/>面對打席</th>
								<th>H<br/>被安打</th>
								<th>HR<br/>被全壘打</th>
								<th>SO<br/>三振</th>
								<th>BB<br/>四壞</th>
								<th>IBB<br/>故意</th>
								<th>R<br/>失分</th>
								<th>ER<br/>自責</th>
								<th>SampleIP<br/>樣本局數</th>
							</tr>
						</thead>
						<% if @allPitchingIP.size != 0 %>
							<tbody>
								<% @allPitchingIP.each do |allPitIP| %>
									<tr>
										<td><%= allPitIP.player_id %></td>
										<td><%= '%.2f' % allPitIP.TBF_5IP.round(2) %> / <%= '%.2f' % allPitIP.TBF_7IP.round(2) %></td>
										<td><%= '%.2f' % allPitIP.H_5IP.round(2) %> / <%= '%.2f' % allPitIP.H_7IP.round(2) %></td>
										<td><%= '%.2f' % allPitIP.HR_5IP.round(2) %> / <%= '%.2f' % allPitIP.HR_7IP.round(2) %></td>
										<td><%= '%.2f' % allPitIP.SO_5IP.round(2) %> / <%= '%.2f' % allPitIP.SO_7IP.round(2) %></td>
										<td><%= '%.2f' % allPitIP.BB_5IP.round(2) %> / <%= '%.2f' % allPitIP.BB_7IP.round(2) %></td>
										<td><%= '%.2f' % allPitIP.IBB_5IP.round(2) %> / <%= '%.2f' % allPitIP.IBB_7IP.round(2) %></td>
										<td><%= '%.2f' % allPitIP.R_5IP.round(2) %> / <%= '%.2f' % allPitIP.R_7IP.round(2) %></td>
										<td><%= '%.2f' % allPitIP.ER_5IP.round(2) %> / <%= '%.2f' % allPitIP.ER_7IP.round(2) %></td>
										<td><%= '%.1f' % allPitIP.IP.round(1) %></td>
									</tr>
								<% end %>
							</tbody>	
						<% end %>
					</table>
				</div>
			<% elsif @player != 'all' %>
				<h4><%= @player %></h4>
				<br/>
				<h4><%= @year == "Wildcard"? ("不分年度"):(@year.to_s + '年(' + (@year.to_i-1911).to_s + '年度)') %> <%= @cup %> 統計資料</h4>
				<br/>
				<% if @year == 'Wildcard' %>
					<div class="table-responsive" id="div_pitching_playerEachYear">
						<table class="table table-striped table-condensed" id="table_pitching_playerEachYear">
							<thead>
								<tr>
									<th>Year<br/>年度</th>
									<th>G<br/>場次</th>
									<th>W<br/>勝投</th>
									<th>L<br/>敗投</th>
									<th>IP<br/>局數</th>
									<th>TBF<br/>面對打席</th>
									<th>H<br/>被安打</th>
									<th>HR<br/>被全壘打</th>
									<th>SO<br/>三振</th>
									<th>BB<br/>四壞</th>
									<th>IBB<br/>故意</th>
									<th>R<br/>失分</th>
									<th>ER<br/>自責</th>
									<th>AVG<br/>被打擊率</th>
									<th>WHIP<br/>每局被上壘率</th>
									<th>ERA5<br/>五局防禦率</th>
									<th>ERA7<br/>七局防禦率</th>
									<th>R/5<br/>五局失分率</th>
									<th>R/7<br/>七局失分率</th>
								</tr>
							</thead>
							<tbody>
								<% if @playerPitchingEachYear.size != 0 %>
									<% @playerPitchingEachYear.each do |eachyear| %>
										<tr>
											<td><%= link_to eachyear.year, controller: "records", action: "pitching", player: @player, year: eachyear.year %></td>
											<td><%= eachyear.G %></td>
											<td><%= eachyear.W %></td>
											<td><%= eachyear.L %></td>
											<td><%= '%.1f' % eachyear.IP.round(1) %></td>
											<td><%= eachyear.TBF %></td>
											<td><%= eachyear.H %></td>
											<td><%= eachyear.HR %></td>
											<td><%= eachyear.SO %></td>
											<td><%= eachyear.BB %></td>
											<td><%= eachyear.IBB %></td>
											<td><%= eachyear.R %></td>
											<td><%= eachyear.ER %></td>
											<td>
												<% if eachyear.TBF - eachyear.BB - eachyear.IBB == 0 %>
													<% if eachyear.H == 0 %>
														-.---
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.3f' % eachyear.AVG.round(3) %>
												<% end %>
											</td>
											<td>
												<% if eachyear.IP == 0.0 %>
													<% if eachyear.H + eachyear.BB + eachyear.IBB == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % eachyear.WHIP.round(2) %>
												<% end %>
											</td>
											<td>
												<% if eachyear.IP == 0.0 %>
													<% if eachyear.ER == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % eachyear.ERA5.round(2) %>
												<% end %>
											</td>
											<td>
												<% if eachyear.IP == 0.0 %>
													<% if eachyear.ER == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % eachyear.ERA7.round(2) %>
												<% end %>
											</td>
											<td>
												<% if eachyear.IP == 0.0 %>
													<% if eachyear.R == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % eachyear.R5.round(2) %>
												<% end %>
											</td>
											<td>
												<% if eachyear.IP == 0.0 %>
													<% if eachyear.R == 0 %>
														-.--
													<% else %>
														∞
													<% end %>
												<% else %>
													<%= '%.2f' % eachyear.R7.round(2) %>
												<% end %>
											</td>
										</tr>
									<% end %>
								<% end %>
							</tbody>
						</table>
					</div>
					<br/>
				<% end %>
				<div class="table-responsive" id="div_pitching_player">
					<table class="table table-condensed" id="table_pitching_player">
						<thead>
							<tr>
								<th>G<br/>場次</th>
								<th>W<br/>勝投</th>
								<th>L<br/>敗投</th>
								<th>IP<br/>局數</th>
								<th>TBF<br/>面對打席</th>
								<th>H<br/>被安打</th>
								<th>HR<br/>被全壘打</th>
								<th>SO<br/>三振</th>
								<th>BB<br/>四壞</th>
								<th>IBB<br/>故意</th>
								<th>R<br/>失分</th>
								<th>ER<br/>自責</th>
								<th>AVG<br/>被打擊率</th>
								<th>WHIP<br/>每局被上壘率</th>
								<th>ERA5<br/>五局防禦率</th>
								<th>ERA7<br/>七局防禦率</th>
								<th>R/5<br/>五局失分率</th>
								<th>R/7<br/>七局失分率</th>
							</tr>
						</thead>
						<% if @playerPitchingSummary.TBF != nil %>
							<tbody>
								<tr>
									<td><%= @playerPitchingSummary.G %></td>
									<td><%= @playerPitchingSummary.W %></td>
									<td><%= @playerPitchingSummary.L %></td>
									<td><%= '%.1f' % @playerPitchingSummary.IP.round(1) %></td>
									<td><%= @playerPitchingSummary.TBF %></td>
									<td><%= @playerPitchingSummary.H %></td>
									<td><%= @playerPitchingSummary.HR %></td>
									<td><%= @playerPitchingSummary.SO %></td>
									<td><%= @playerPitchingSummary.BB %></td>
									<td><%= @playerPitchingSummary.IBB %></td>
									<td><%= @playerPitchingSummary.R %></td>
									<td><%= @playerPitchingSummary.ER %></td>
									<td>
										<% if @playerPitchingSummary.TBF - @playerPitchingSummary.BB - @playerPitchingSummary.IBB == 0 %>
											<% if @playerPitchingSummary.H == 0 %>
												-.---
											<% else %>
												∞
											<% end %>
										<% else %>
											<%= '%.3f' % @playerPitchingSummary.AVG.round(3) %>
										<% end %>
										
									</td>
									<td>
										<% if @playerPitchingSummary.IP == 0.0 %>
											<% if @playerPitchingSummary.H + @playerPitchingSummary.BB + @playerPitchingSummary.IBB == 0 %>
												-.--
											<% else %>
												∞
											<% end %>
										<% else %>
											<%= '%.2f' % @playerPitchingSummary.WHIP.round(2) %>
										<% end %>
									</td>
									<td>
										<% if @playerPitchingSummary.IP == 0.0 %>
											<% if @playerPitchingSummary.ER == 0 %>
												-.--
											<% else %>
												∞
											<% end %>
										<% else %>
											<%= '%.2f' % @playerPitchingSummary.ERA5.round(2) %>
										<% end %>
									</td>
									<td>
										<% if @playerPitchingSummary.IP == 0.0 %>
											<% if @playerPitchingSummary.ER == 0 %>
												-.--
											<% else %>
												∞
											<% end %>
										<% else %>
											<%= '%.2f' % @playerPitchingSummary.ERA7.round(2) %>
										<% end %>
									</td>
									<td>
										<% if @playerPitchingSummary.IP == 0.0 %>
											<% if @playerPitchingSummary.R == 0 %>
												-.--
											<% else %>
												∞
											<% end %>
										<% else %>
											<%= '%.2f' % @playerPitchingSummary.R5.round(2) %>
										<% end %>
									</td>
									<td>
										<% if @playerPitchingSummary.IP == 0.0 %>
											<% if @playerPitchingSummary.R == 0 %>
												-.--
											<% else %>
												∞
											<% end %>
										<% else %>
											<%= '%.2f' % @playerPitchingSummary.R7.round(2) %>
										<% end %>
									</td>
								</tr>
							</tbody>
						<% end %>
					</table>
				</div>
				<br/>
				<h4>平均五/七局表現</h4>
				<br/>
				<div class="table-responsive" id="div_pitching_playerIP">
					<table class="table table-condensed" id="table_pitching_playerIP">
						<thead>
							<tr>
								<th>TBF<br/>面對打席</th>
								<th>H<br/>被安打</th>
								<th>HR<br/>被全壘打</th>
								<th>SO<br/>三振</th>
								<th>BB<br/>四壞</th>
								<th>IBB<br/>故意</th>
								<th>R<br/>失分</th>
								<th>ER<br/>自責</th>
								<th>SampleIP<br/>樣本局數</th>
							</tr>
						</thead>
						<% if @playerPitchingSummary.IP != nil %>
							<tbody>
								<tr>
									<td><%= '%.2f' % (@playerPitchingSummary.TBF / @playerPitchingSummary.IP * 5.0).round(2) %> / <%= '%.2f' % (@playerPitchingSummary.TBF / @playerPitchingSummary.IP * 7.0).round(2) %></td>
									<td><%= '%.2f' % (@playerPitchingSummary.H / @playerPitchingSummary.IP * 5.0).round(2) %> / <%= '%.2f' % (@playerPitchingSummary.H / @playerPitchingSummary.IP * 7.0).round(2) %></td>
									<td><%= '%.2f' % (@playerPitchingSummary.HR / @playerPitchingSummary.IP * 5.0).round(2) %> / <%= '%.2f' % (@playerPitchingSummary.HR / @playerPitchingSummary.IP * 7.0).round(2) %></td>
									<td><%= '%.2f' % (@playerPitchingSummary.SO / @playerPitchingSummary.IP * 5.0).round(2) %> / <%= '%.2f' % (@playerPitchingSummary.SO / @playerPitchingSummary.IP * 7.0).round(2) %></td>
									<td><%= '%.2f' % (@playerPitchingSummary.BB / @playerPitchingSummary.IP * 5.0).round(2) %> / <%= '%.2f' % (@playerPitchingSummary.BB / @playerPitchingSummary.IP * 7.0).round(2) %></td>
									<td><%= '%.2f' % (@playerPitchingSummary.IBB / @playerPitchingSummary.IP * 5.0).round(2) %> / <%= '%.2f' % (@playerPitchingSummary.IBB / @playerPitchingSummary.IP * 7.0).round(2) %></td>
									<td><%= '%.2f' % (@playerPitchingSummary.R / @playerPitchingSummary.IP * 5.0).round(2) %> / <%= '%.2f' % (@playerPitchingSummary.R / @playerPitchingSummary.IP * 7.0).round(2) %></td>
									<td><%= '%.2f' % (@playerPitchingSummary.ER / @playerPitchingSummary.IP * 5.0).round(2) %> / <%= '%.2f' % (@playerPitchingSummary.ER / @playerPitchingSummary.IP * 7.0).round(2) %></td>
									<td><%= '%.1f' % @playerPitchingSummary.IP.round(1) %></td>
								</tr>
							</tbody>
						<% end %>
					</table>
				</div>
				<br/>
				<h4>防禦率長條圖</h4>
				<br/>
				<form>
				<input type="checkbox" name="era_ckeckbox" data-on-text="ERA5" data-off-text="ERA7" data-off-color="primary" checked>
				</form>
				<div class="table-responsive" id="div_pitching_Graph_ERA5">
					<div id="bar-chart">
						<div class="y-title">
							防<br/>禦<br/>率
						</div>
						<div class="graph">
							<ul class="x-axis">
								<li><span>個 人 出 賽 場 次</span></li>
							</ul>
							<ul class="y-axis">
								<li>
									<span>
										<% if @ERA5Data.size != 0 %>
											<% if @ERA5_Max == Float::INFINITY %>
												∞
											<% else %>
												<% if @ERA5_Max > 10.0 %>
													<%= '%.2f' % @ERA5_Max.to_f.round(2) %>
												<% else %>
													10.00
												<% end %>
											<% end %>
										<% end %>
									</span>
								</li>
								<li>
									<span>
										<% if @ERA5Data.size != 0 %>
											<% if @ERA5_Max == Float::INFINITY %>
												150.00
											<% else %>
												<% if @ERA5_Max > 10.0 %>
													<%= '%.2f' % (@ERA5_Max * 0.75).round(2) %>
												<% else %>
													7.50
												<% end %>
											<% end %>
										<% end %>
									</span>
								</li>
								<li>
									<span>
										<% if @ERA5Data.size != 0 %>
											<% if @ERA5_Max == Float::INFINITY %>
												100.00
											<% else %>
												<% if @ERA5_Max > 10.0 %>
													<%= '%.2f' % (@ERA5_Max * 0.5).round(2) %>
												<% else %>
													5.00
												<% end %>
											<% end %>
										<% end %>
									</span>
								</li>
								<li>
									<span>
										<% if @ERA5Data.size != 0 %>
											<% if @ERA5_Max == Float::INFINITY %>
												50.00
											<% else %>
												<% if @ERA5_Max > 10.0 %>
													<%= '%.2f' % (@ERA5_Max * 0.25).round(2) %>
												<% else %>
													2.50
												<% end %>
											<% end %>
										<% end %>
									</span>
								</li>
								<li><span>0.00</span></li>
							</ul>
							<div class="bars" id="bars_era5">
								<div class="bar-group">
									<% if @ERA5Data.size != 0 %>
										<% @ERA5Data.each do |era5Data| %>
											<div class="bar bar-<%= era5Data[0] + 1 %> stat" data-height="<%= (era5Data[1] == Float::INFINITY)? (1):((@ERA5_Max > 10.0)?('%.3f' % (era5Data[1] / @ERA5_Max.to_f).round(3)):('%.3f' % (era5Data[1] / 10.0).round(3))) %>" style="height: <%= (era5Data[1] == Float::INFINITY)? (100):((@ERA5_Max > 10.0)?('%.3f' % (era5Data[1] / @ERA5_Max.to_f * 100.0).round(3)):('%.3f' % (era5Data[1] / 10.0 * 100.0).round(3))) %>%;" data-toggle="tooltip" title="<%= (era5Data[1] == Float::INFINITY)?('∞'):('%.2f' % era5Data[1].round(2)) %>">
												<span><%= (era5Data[1] == Float::INFINITY)?('∞'):('%.2f' % era5Data[1].round(2)) %></span>
											</div>
										<% end %>
									<% end %>
								</div>
							</div>
						</div>
						<div class="graphSummary" id="graphSummary_era5">
							<% if @ERA5Data.size != 0 %>
								Max : <%= (@ERA5_Max == Float::INFINITY)?('∞'):('%.2f' % @ERA5_Max.round(2)) %><br/>
								Cur : <%= (@ERA5Data[@ERA5Data.size - 1][1] == Float::INFINITY)?('∞'):('%.2f' % @ERA5Data[@ERA5Data.size - 1][1].round(2)) %><br/>
								Min : <%= (@ERA5_Min == Float::INFINITY)?('∞'):('%.2f' % @ERA5_Min.round(2)) %>
							<% else %>
								Max:0.00<br/>
								Cur:0.00<br/>
								Min:0.00
							<% end %>
						</div>
					</div>
				</div>
				<div class="table-responsive" id="div_pitching_Graph_ERA7">
					<div id="bar-chart">
						<div class="y-title">
							防<br/>禦<br/>率
						</div>
						<div class="graph">
							<ul class="x-axis">
								<li><span>個 人 出 賽 場 次</span></li>
							</ul>
							<ul class="y-axis">
								<li>
									<span>
										<% if @ERA7Data.size != 0 %>
											<% if @ERA7_Max == Float::INFINITY %>
												∞
											<% else %>
												<% if @ERA7_Max > 10.0 %>
													<%= '%.2f' % @ERA7_Max.to_f.round(2) %>
												<% else %>
													10.00
												<% end %>
											<% end %>
										<% end %>
									</span>
								</li>
								<li>
									<span>
										<% if @ERA7Data.size != 0 %>
											<% if @ERA7_Max == Float::INFINITY %>
												150.00
											<% else %>
												<% if @ERA7_Max > 10.0 %>
													<%= '%.2f' % (@ERA7_Max * 0.75).round(2) %>
												<% else %>
													7.50
												<% end %>
											<% end %>
										<% end %>
									</span>
								</li>
								<li>
									<span>
										<% if @ERA7Data.size != 0 %>
											<% if @ERA7_Max == Float::INFINITY %>
												100.00
											<% else %>
												<% if @ERA7_Max > 10.0 %>
													<%= '%.2f' % (@ERA7_Max * 0.5).round(2) %>
												<% else %>
													5.00
												<% end %>
											<% end %>
										<% end %>
									</span>
								</li>
								<li>
									<span>
										<% if @ERA7Data.size != 0 %>
											<% if @ERA7_Max == Float::INFINITY %>
												50.00
											<% else %>
												<% if @ERA7_Max > 10.0 %>
													<%= '%.2f' % (@ERA7_Max * 0.25).round(2) %>
												<% else %>
													2.50
												<% end %>
											<% end %>
										<% end %>
									</span>
								</li>
								<li><span>0.00</span></li>
							</ul>
							<div class="bars" id="bars_era7">
								<div class="bar-group">
									<% if @ERA7Data.size != 0 %>
										<% @ERA7Data.each do |era7Data| %>
											<div class="bar bar-<%= era7Data[0] + 1 %> stat" data-height="<%= (era7Data[1] == Float::INFINITY)? (1):((@ERA7_Max > 10.0)?((@ERA7_Max == Float::INFINITY)?('%.3f' % (era7Data[1] / 200.0).round(3)):('%.3f' % (era7Data[1] / @ERA7_Max.to_f).round(3))):('%.3f' % (era7Data[1] / 10.0).round(3))) %>" style="height: <%= (era7Data[1] == Float::INFINITY)? (100):((@ERA7_Max > 10.0)?('%.3f' % (era7Data[1] / @ERA7_Max.to_f * 100.0).round(3)):('%.3f' % (era7Data[1] / 10.0 * 100.0).round(3))) %>%;" data-toggle="tooltip" title="<%= (era7Data[1] == Float::INFINITY)?('∞'):('%.2f' % era7Data[1].round(2)) %>">
												<span><%= (era7Data[1] == Float::INFINITY)?('∞'):('%.2f' % era7Data[1].round(2)) %></span>
											</div>
										<% end %>
									<% end %>
								</div>
							</div>
						</div>
						<div class="graphSummary" id="graphSummary_era7">
							<% if @ERA7Data.size != 0 %>
								Max : <%= (@ERA7_Max == Float::INFINITY)?('∞'):('%.2f' % @ERA7_Max.round(2)) %><br/>
								Cur : <%= (@ERA7Data[@ERA7Data.size - 1][1] == Float::INFINITY)?('∞'):('%.2f' % @ERA7Data[@ERA7Data.size - 1][1].round(2)) %><br/>
								Min : <%= (@ERA7_Min == Float::INFINITY)?('∞'):('%.2f' % @ERA7_Min.round(2)) %>
							<% else %>
								Max:0.00<br/>
								Cur:0.00<br/>
								Min:0.00
							<% end %>
						</div>
					</div>
				</div>
				<script>
					$(function () {
						$('[data-toggle="tooltip"]').tooltip();
						$("[name='era_ckeckbox']").bootstrapSwitch();
						
						$('input[name="era_ckeckbox"]').on('switchChange.bootstrapSwitch', function(event, state) {
							if(state){
								$('#div_pitching_Graph_ERA5').show();
								$('#div_pitching_Graph_ERA7').hide();
							}
							else{
								$('#div_pitching_Graph_ERA7').show();
								$('#div_pitching_Graph_ERA5').hide();
							}
						});
					})
					function switchGraph(){
						if($("[name='era_ckeckbox']").attr('checked')){
							$('#div_pitching_Graph_ERA5').show();
							$('#div_pitching_Graph_ERA7').hide();
						}
						else{
							$('#div_pitching_Graph_ERA7').show();
							$('#div_pitching_Graph_ERA5').hide();
						}
					}
					$(window).on('load resize', function(){
						switchGraph();
						
						$('.stat').each(function(){
							dataHeight = $(this).attr('data-height');
							red_index = parseInt(255 * dataHeight);
							green_index = parseInt(255 * (1 - dataHeight));
							color_light = "rgba(" + red_index + "," + green_index + ",0,1)";
							color_dark = "rgba(" + red_index + "," + green_index + ",0,0.8)";
							
							$(this).css({
								background: "-webkit-linear-gradient(left, " + color_light + " 0%, " + color_light + " 47%, " + color_dark + " 50%, " + color_dark + " 100%)"
							});
							$(this).css({
								'background-image': "linear-gradient(to right, " + color_light + " 0%, " + color_light + " 47%, " + color_dark + " 50%, " + color_dark + " 100%)"
							});
						});
						
						// 因為ERA5和ERA7數量一樣，所以可以沿用
						for(i = 1 ; i <= <%= @ERA5Data.size %> ; i++){
							$('.bar-'+i).css({
								'animation-delay': (0.1 + 0.02 * i).toString() + 's',
								'-webkit-animation-delay': (0.1 + 0.02 * i).toString() + 's'
							});
							if(i >= 2){
								$('.bar:nth-child('+i+')').css({
									left: (15 * (i - 1)).toString() + '%' 
								});
							}
						}
						if(<%= @ERA5Data.size %> >= 2)
							graphLength = parseInt($('.bar:last-child').css('left')) + 40;
						else
							graphLength = 40;
						
						$('.x-axis').css({
							width: graphLength,
							'min-width': '100%'
						});
						$('.y-axis').css({
							width: graphLength,
							'min-width': '100%'
						});
						// ERA5和ERA7的最後一個bar高度不同，要分開算
						$('#graphSummary_era5').css('left',graphLength);
						$('#graphSummary_era7').css('left',graphLength);
						summaryHeight_era5 = parseInt($('#bars_era5').height() * (1- $('#bars_era5 > .bar-group > .bar:last-child').attr('data-height'))) - 30;
						summaryHeight_era7 = parseInt($('#bars_era7').height() * (1- $('#bars_era7 > .bar-group > .bar:last-child').attr('data-height'))) - 30;
						//console.log('era5:'+$('#bars_era5 > .bar-group > .bar:last-child').attr('data-height'));
						//console.log('era7:'+$('#bars_era7 > .bar-group > .bar:last-child').attr('data-height'));
						$('#graphSummary_era5').css('top',summaryHeight_era5);
						$('#graphSummary_era7').css('top',summaryHeight_era7);
					});
				</script>
				<br/>
				<h4><%= @year == "Wildcard"? ("不分年度"):(@year.to_s + '年(' + (@year.to_i-1911).to_s + '年度)') %> <%= @cup %> 詳細資料</h4>
				<br/>
				<div class="table-responsive" id="div_pitching_playerDetail">
					<table class="table table-striped table-condensed" id="table_pitching_playerDetail">
						<thead>
							<tr>
								<th>G<br/>場次</th>
								<th>W<br/>勝投</th>
								<th>L<br/>敗投</th>
								<th>IP<br/>局數</th>
								<th>TBF<br/>面對打席</th>
								<th>H<br/>被安打</th>
								<th>HR<br/>被全壘打</th>
								<th>SO<br/>三振</th>
								<th>BB<br/>四壞</th>
								<th>IBB<br/>故意</th>
								<th>R<br/>失分</th>
								<th>ER<br/>自責</th>
								<th>AVG<br/>被打擊率</th>
								<th>WHIP<br/>每局被上壘率</th>
								<th>ERA5<br/>五局防禦率</th>
								<th>ERA7<br/>七局防禦率</th>
								<th>R/5<br/>五局失分率</th>
								<th>R/7<br/>七局失分率</th>
								<th>CERA5<br/>累積五局防禦率</th>
								<th>CERA7<br/>累積七局防禦率</th>
							</tr>
						</thead>
						<tbody>
							<% if @playerPitchingForGraph.size != 0 %>
								<% @playerPitchingForGraph.each_with_index do |detail, index| %>
									<tr>
										<td><%= link_to detail.game_id, controller: "records", action: "game", game_id: detail.game_id %></td>
										<td><%= detail.W %></td>
										<td><%= detail.L %></td>
										<td><%= '%.1f' % detail.IP.round(1) %></td>
										<td><%= detail.TBF %></td>
										<td><%= detail.H %></td>
										<td><%= detail.HR %></td>
										<td><%= detail.SO %></td>
										<td><%= detail.BB %></td>
										<td><%= detail.IBB %></td>
										<td><%= detail.R %></td>
										<td><%= detail.ER %></td>
										<td>
											<% if detail.TBF - detail.BB - detail.IBB == 0 %>
												<% if detail.H == 0 %>
													-.---
												<% else %>
													∞
												<% end %>
											<% else %>
												<%= '%.3f' % detail.AVG.round(3) %>
											<% end %>
										</td>
										<td>
											<% if detail.IP == 0.0 %>
												<% if detail.H + detail.BB + detail.IBB == 0 %>
													-.--
												<% else %>
													∞
												<% end %>
											<% else %>
												<%= '%.2f' % detail.WHIP.round(2) %>
											<% end %>
										</td>
										<td>
											<% if detail.IP == 0.0 %>
												<% if detail.ER == 0 %>
													-.--
												<% else %>
													∞
												<% end %>
											<% else %>
												<%= '%.2f' % detail.ERA5.round(2) %>
											<% end %>
										</td>
										<td>
											<% if detail.IP == 0.0 %>
												<% if detail.ER == 0 %>
													-.--
												<% else %>
													∞
												<% end %>
											<% else %>
												<%= '%.2f' % detail.ERA7.round(2) %>
											<% end %>
										</td>
										<td>
											<% if detail.IP == 0.0 %>
												<% if detail.R == 0 %>
													-.--
												<% else %>
													∞
												<% end %>
											<% else %>
												<%= '%.2f' % detail.R5.round(2) %>
											<% end %>
										</td>
										<td>
											<% if detail.IP == 0.0 %>
												<% if detail.R == 0 %>
													-.--
												<% else %>
													∞
												<% end %>
											<% else %>
												<%= '%.2f' % detail.R7.round(2) %>
											<% end %>
										</td>
										<td><%= '%.2f' % @ERA5Data[index][1].round(2) %></td>
										<td><%= '%.2f' % @ERA7Data[index][1].round(2) %></td>
									</tr>
								<% end %>
							<% end %>
						</tbody>
					</table>
				</div>
			<% end %>
        </div>
        <!--/col-span-9-->
    </div>
</div>
<!-- /Main -->
</section>